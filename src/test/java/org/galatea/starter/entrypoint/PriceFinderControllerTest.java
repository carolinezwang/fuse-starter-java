package org.galatea.starter.entrypoint;
import static org.hamcrest.Matchers.is;
import static org.mockito.BDDMockito.given;
import static org.springframework.test.web.servlet.request.MockMvcRequestBuilders.get;
import static org.springframework.test.web.servlet.result.MockMvcResultMatchers.jsonPath;

import com.fasterxml.jackson.databind.JsonNode;
import com.fasterxml.jackson.databind.ObjectMapper;
import com.fasterxml.jackson.databind.node.ArrayNode;
import com.fasterxml.jackson.databind.node.ObjectNode;
import java.io.File;
import java.io.InputStream;
import java.util.Iterator;
import java.util.Map;
import junitparams.JUnitParamsRunner;
import lombok.RequiredArgsConstructor;
import lombok.extern.slf4j.Slf4j;
import org.apache.commons.collections4.map.HashedMap;
import org.galatea.starter.ASpringTest;
import org.galatea.starter.service.HalService;
import org.junit.Assert;
import org.junit.Test;
import org.junit.runner.RunWith;
import org.mockito.InjectMocks;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.boot.test.autoconfigure.web.servlet.WebMvcTest;
import org.springframework.boot.test.mock.mockito.MockBean;
import org.springframework.http.HttpStatus;
import org.springframework.http.MediaType;
import org.springframework.http.ResponseEntity;
import org.springframework.test.web.servlet.MockMvc;
import org.springframework.test.web.servlet.result.MockMvcResultMatchers;
import org.springframework.web.client.RestTemplate;


@RequiredArgsConstructor
@Slf4j
// We don't load the entire spring application context for this test.
@WebMvcTest(PriceFinderController.class)
// Use this runner since we want to parameterize certain tests.
// See runner's javadoc for more usage.
@RunWith(JUnitParamsRunner.class)
public class PriceFinderControllerTest extends ASpringTest {
  @Autowired
  private MockMvc mvc;
  @MockBean
  private RestTemplate mockRestTemplate;


  @Test
  public void testEndpoint() throws Exception {
    ObjectMapper mapper = new ObjectMapper();
    String stock = "IBM";

    //String result is expected outputted result from accessAV service given the input from website
    String result = "{\"IBM Daily Stock Prices for Last 1 Days\":[{\"IBM Stock Price on 2020-09-15\":{\"1. open\":\"122.8200\",\"2. high\":\"123.4000\",\"3. low\":\"122.2400\",\"4. close\":\"122.4400\",\"5. volume\":\"2915221\"}}]}";

    String avURL = "https://www.alphavantage.co/query?function=TIME_SERIES_DAILY&symbol=" + stock + "&apikey=795KUDT4Z4PZM2DP";

    //AV output (copied from API query) as string body for response entity
    //acts as mock output for .getForEntity by mock rest template
    String body = "{\n"
        + "  \"Meta Data\": {\n"
        + "    \"1. Information\": \"Daily Prices (open, high, low, close) and Volumes\",\n"
        + "    \"2. Symbol\": \"IBM\",\n"
        + "    \"3. Last Refreshed\": \"2020-09-15\",\n"
        + "    \"4. Output Size\": \"Compact\",\n"
        + "    \"5. Time Zone\": \"US/Eastern\"\n"
        + "  },\n"
        + "  \"Time Series (Daily)\": {\n"
        + "    \"2020-09-15\": {\n"
        + "      \"1. open\": \"122.8200\",\n"
        + "      \"2. high\": \"123.4000\",\n"
        + "      \"3. low\": \"122.2400\",\n"
        + "      \"4. close\": \"122.4400\",\n"
        + "      \"5. volume\": \"2915221\"\n"
        + "    },\n"
        + "    \"2020-09-14\": {\n"
        + "      \"1. open\": \"122.3600\",\n"
        + "      \"2. high\": \"123.3800\",\n"
        + "      \"3. low\": \"121.7600\",\n"
        + "      \"4. close\": \"122.0900\",\n"
        + "      \"5. volume\": \"3641887\"\n"
        + "    },\n"
        + "    \"2020-09-11\": {\n"
        + "      \"1. open\": \"121.3900\",\n"
        + "      \"2. high\": \"122.7000\",\n"
        + "      \"3. low\": \"120.7300\",\n"
        + "      \"4. close\": \"121.4600\",\n"
        + "      \"5. volume\": \"3548091\"\n"
        + "    },\n"
        + "    \"2020-09-10\": {\n"
        + "      \"1. open\": \"122.5300\",\n"
        + "      \"2. high\": \"123.5764\",\n"
        + "      \"3. low\": \"120.2400\",\n"
        + "      \"4. close\": \"120.5600\",\n"
        + "      \"5. volume\": \"3978805\"\n"
        + "    },\n"
        + "    \"2020-09-09\": {\n"
        + "      \"1. open\": \"122.1300\",\n"
        + "      \"2. high\": \"123.7000\",\n"
        + "      \"3. low\": \"121.2900\",\n"
        + "      \"4. close\": \"122.2600\",\n"
        + "      \"5. volume\": \"3770678\"\n"
        + "    },\n"
        + "    \"2020-09-08\": {\n"
        + "      \"1. open\": \"122.1600\",\n"
        + "      \"2. high\": \"122.8700\",\n"
        + "      \"3. low\": \"120.7100\",\n"
        + "      \"4. close\": \"121.2100\",\n"
        + "      \"5. volume\": \"5210292\"\n"
        + "    },\n"
        + "    \"2020-09-04\": {\n"
        + "      \"1. open\": \"124.3500\",\n"
        + "      \"2. high\": \"125.3500\",\n"
        + "      \"3. low\": \"121.2400\",\n"
        + "      \"4. close\": \"122.3000\",\n"
        + "      \"5. volume\": \"6018238\"\n"
        + "    },\n"
        + "    \"2020-09-03\": {\n"
        + "      \"1. open\": \"128.1900\",\n"
        + "      \"2. high\": \"129.9500\",\n"
        + "      \"3. low\": \"123.6500\",\n"
        + "      \"4. close\": \"124.4500\",\n"
        + "      \"5. volume\": \"5716750\"\n"
        + "    },\n"
        + "    \"2020-09-02\": {\n"
        + "      \"1. open\": \"123.7200\",\n"
        + "      \"2. high\": \"128.7000\",\n"
        + "      \"3. low\": \"123.5750\",\n"
        + "      \"4. close\": \"128.1800\",\n"
        + "      \"5. volume\": \"6592430\"\n"
        + "    },\n"
        + "    \"2020-09-01\": {\n"
        + "      \"1. open\": \"122.8500\",\n"
        + "      \"2. high\": \"123.9500\",\n"
        + "      \"3. low\": \"122.1500\",\n"
        + "      \"4. close\": \"123.4000\",\n"
        + "      \"5. volume\": \"3155623\"\n"
        + "    },\n"
        + "    \"2020-08-31\": {\n"
        + "      \"1. open\": \"125.2500\",\n"
        + "      \"2. high\": \"125.2500\",\n"
        + "      \"3. low\": \"123.0300\",\n"
        + "      \"4. close\": \"123.3100\",\n"
        + "      \"5. volume\": \"4827879\"\n"
        + "    },\n"
        + "    \"2020-08-28\": {\n"
        + "      \"1. open\": \"124.9600\",\n"
        + "      \"2. high\": \"125.3000\",\n"
        + "      \"3. low\": \"124.2187\",\n"
        + "      \"4. close\": \"125.0700\",\n"
        + "      \"5. volume\": \"3099940\"\n"
        + "    },\n"
        + "    \"2020-08-27\": {\n"
        + "      \"1. open\": \"124.6000\",\n"
        + "      \"2. high\": \"125.1000\",\n"
        + "      \"3. low\": \"123.9800\",\n"
        + "      \"4. close\": \"124.6500\",\n"
        + "      \"5. volume\": \"3422654\"\n"
        + "    },\n"
        + "    \"2020-08-26\": {\n"
        + "      \"1. open\": \"124.9500\",\n"
        + "      \"2. high\": \"125.1200\",\n"
        + "      \"3. low\": \"123.9500\",\n"
        + "      \"4. close\": \"124.1700\",\n"
        + "      \"5. volume\": \"3388687\"\n"
        + "    },\n"
        + "    \"2020-08-25\": {\n"
        + "      \"1. open\": \"126.0000\",\n"
        + "      \"2. high\": \"126.8200\",\n"
        + "      \"3. low\": \"124.4900\",\n"
        + "      \"4. close\": \"124.6400\",\n"
        + "      \"5. volume\": \"2977697\"\n"
        + "    },\n"
        + "    \"2020-08-24\": {\n"
        + "      \"1. open\": \"123.7900\",\n"
        + "      \"2. high\": \"126.0600\",\n"
        + "      \"3. low\": \"123.3600\",\n"
        + "      \"4. close\": \"125.6800\",\n"
        + "      \"5. volume\": \"4070816\"\n"
        + "    },\n"
        + "    \"2020-08-21\": {\n"
        + "      \"1. open\": \"123.0100\",\n"
        + "      \"2. high\": \"123.4842\",\n"
        + "      \"3. low\": \"122.3100\",\n"
        + "      \"4. close\": \"123.1600\",\n"
        + "      \"5. volume\": \"3385051\"\n"
        + "    },\n"
        + "    \"2020-08-20\": {\n"
        + "      \"1. open\": \"123.2000\",\n"
        + "      \"2. high\": \"124.0400\",\n"
        + "      \"3. low\": \"122.8100\",\n"
        + "      \"4. close\": \"123.1500\",\n"
        + "      \"5. volume\": \"2561164\"\n"
        + "    },\n"
        + "    \"2020-08-19\": {\n"
        + "      \"1. open\": \"124.8300\",\n"
        + "      \"2. high\": \"125.5000\",\n"
        + "      \"3. low\": \"123.5000\",\n"
        + "      \"4. close\": \"123.8400\",\n"
        + "      \"5. volume\": \"3743949\"\n"
        + "    },\n"
        + "    \"2020-08-18\": {\n"
        + "      \"1. open\": \"125.0000\",\n"
        + "      \"2. high\": \"125.5000\",\n"
        + "      \"3. low\": \"124.2400\",\n"
        + "      \"4. close\": \"124.9200\",\n"
        + "      \"5. volume\": \"2882355\"\n"
        + "    },\n"
        + "    \"2020-08-17\": {\n"
        + "      \"1. open\": \"125.2500\",\n"
        + "      \"2. high\": \"125.5900\",\n"
        + "      \"3. low\": \"124.4100\",\n"
        + "      \"4. close\": \"124.4400\",\n"
        + "      \"5. volume\": \"3336459\"\n"
        + "    },\n"
        + "    \"2020-08-14\": {\n"
        + "      \"1. open\": \"124.2000\",\n"
        + "      \"2. high\": \"125.5600\",\n"
        + "      \"3. low\": \"123.9100\",\n"
        + "      \"4. close\": \"125.2700\",\n"
        + "      \"5. volume\": \"2963753\"\n"
        + "    },\n"
        + "    \"2020-08-13\": {\n"
        + "      \"1. open\": \"125.9600\",\n"
        + "      \"2. high\": \"126.3900\",\n"
        + "      \"3. low\": \"124.7700\",\n"
        + "      \"4. close\": \"125.0300\",\n"
        + "      \"5. volume\": \"3171258\"\n"
        + "    },\n"
        + "    \"2020-08-12\": {\n"
        + "      \"1. open\": \"127.6100\",\n"
        + "      \"2. high\": \"127.7900\",\n"
        + "      \"3. low\": \"125.8760\",\n"
        + "      \"4. close\": \"126.7000\",\n"
        + "      \"5. volume\": \"3530177\"\n"
        + "    },\n"
        + "    \"2020-08-11\": {\n"
        + "      \"1. open\": \"128.7600\",\n"
        + "      \"2. high\": \"130.4700\",\n"
        + "      \"3. low\": \"126.6100\",\n"
        + "      \"4. close\": \"126.7500\",\n"
        + "      \"5. volume\": \"5001176\"\n"
        + "    },\n"
        + "    \"2020-08-10\": {\n"
        + "      \"1. open\": \"125.4200\",\n"
        + "      \"2. high\": \"127.2400\",\n"
        + "      \"3. low\": \"125.1849\",\n"
        + "      \"4. close\": \"127.1100\",\n"
        + "      \"5. volume\": \"3968295\"\n"
        + "    },\n"
        + "    \"2020-08-07\": {\n"
        + "      \"1. open\": \"123.5000\",\n"
        + "      \"2. high\": \"125.0700\",\n"
        + "      \"3. low\": \"123.2100\",\n"
        + "      \"4. close\": \"124.9600\",\n"
        + "      \"5. volume\": \"3651226\"\n"
        + "    },\n"
        + "    \"2020-08-06\": {\n"
        + "      \"1. open\": \"125.0000\",\n"
        + "      \"2. high\": \"126.2600\",\n"
        + "      \"3. low\": \"125.0000\",\n"
        + "      \"4. close\": \"126.1200\",\n"
        + "      \"5. volume\": \"3417131\"\n"
        + "    },\n"
        + "    \"2020-08-05\": {\n"
        + "      \"1. open\": \"126.7300\",\n"
        + "      \"2. high\": \"126.7500\",\n"
        + "      \"3. low\": \"124.6100\",\n"
        + "      \"4. close\": \"125.4500\",\n"
        + "      \"5. volume\": \"3675400\"\n"
        + "    },\n"
        + "    \"2020-08-04\": {\n"
        + "      \"1. open\": \"123.8200\",\n"
        + "      \"2. high\": \"125.8600\",\n"
        + "      \"3. low\": \"123.8200\",\n"
        + "      \"4. close\": \"125.8400\",\n"
        + "      \"5. volume\": \"3431366\"\n"
        + "    },\n"
        + "    \"2020-08-03\": {\n"
        + "      \"1. open\": \"123.5000\",\n"
        + "      \"2. high\": \"124.4100\",\n"
        + "      \"3. low\": \"122.1500\",\n"
        + "      \"4. close\": \"124.3100\",\n"
        + "      \"5. volume\": \"3526574\"\n"
        + "    },\n"
        + "    \"2020-07-31\": {\n"
        + "      \"1. open\": \"122.7100\",\n"
        + "      \"2. high\": \"122.9900\",\n"
        + "      \"3. low\": \"121.0900\",\n"
        + "      \"4. close\": \"122.9400\",\n"
        + "      \"5. volume\": \"5277652\"\n"
        + "    },\n"
        + "    \"2020-07-30\": {\n"
        + "      \"1. open\": \"123.7100\",\n"
        + "      \"2. high\": \"123.9046\",\n"
        + "      \"3. low\": \"121.6400\",\n"
        + "      \"4. close\": \"122.9000\",\n"
        + "      \"5. volume\": \"3988062\"\n"
        + "    },\n"
        + "    \"2020-07-29\": {\n"
        + "      \"1. open\": \"124.5600\",\n"
        + "      \"2. high\": \"125.9900\",\n"
        + "      \"3. low\": \"124.0700\",\n"
        + "      \"4. close\": \"125.3200\",\n"
        + "      \"5. volume\": \"2833141\"\n"
        + "    },\n"
        + "    \"2020-07-28\": {\n"
        + "      \"1. open\": \"125.8200\",\n"
        + "      \"2. high\": \"126.3400\",\n"
        + "      \"3. low\": \"124.1500\",\n"
        + "      \"4. close\": \"124.4700\",\n"
        + "      \"5. volume\": \"4178176\"\n"
        + "    },\n"
        + "    \"2020-07-27\": {\n"
        + "      \"1. open\": \"124.8600\",\n"
        + "      \"2. high\": \"126.3200\",\n"
        + "      \"3. low\": \"124.7100\",\n"
        + "      \"4. close\": \"126.2100\",\n"
        + "      \"5. volume\": \"3733547\"\n"
        + "    },\n"
        + "    \"2020-07-24\": {\n"
        + "      \"1. open\": \"126.4800\",\n"
        + "      \"2. high\": \"127.6459\",\n"
        + "      \"3. low\": \"125.5000\",\n"
        + "      \"4. close\": \"125.7900\",\n"
        + "      \"5. volume\": \"3531076\"\n"
        + "    },\n"
        + "    \"2020-07-23\": {\n"
        + "      \"1. open\": \"129.1000\",\n"
        + "      \"2. high\": \"129.3700\",\n"
        + "      \"3. low\": \"127.1500\",\n"
        + "      \"4. close\": \"127.3300\",\n"
        + "      \"5. volume\": \"4220136\"\n"
        + "    },\n"
        + "    \"2020-07-22\": {\n"
        + "      \"1. open\": \"125.9000\",\n"
        + "      \"2. high\": \"129.4700\",\n"
        + "      \"3. low\": \"125.8000\",\n"
        + "      \"4. close\": \"128.6700\",\n"
        + "      \"5. volume\": \"8195366\"\n"
        + "    },\n"
        + "    \"2020-07-21\": {\n"
        + "      \"1. open\": \"131.1600\",\n"
        + "      \"2. high\": \"132.1700\",\n"
        + "      \"3. low\": \"125.8000\",\n"
        + "      \"4. close\": \"126.0600\",\n"
        + "      \"5. volume\": \"15364900\"\n"
        + "    },\n"
        + "    \"2020-07-20\": {\n"
        + "      \"1. open\": \"126.0700\",\n"
        + "      \"2. high\": \"127.0700\",\n"
        + "      \"3. low\": \"125.1400\",\n"
        + "      \"4. close\": \"126.3700\",\n"
        + "      \"5. volume\": \"9927700\"\n"
        + "    },\n"
        + "    \"2020-07-17\": {\n"
        + "      \"1. open\": \"124.3900\",\n"
        + "      \"2. high\": \"125.6300\",\n"
        + "      \"3. low\": \"123.2000\",\n"
        + "      \"4. close\": \"125.1100\",\n"
        + "      \"5. volume\": \"3984600\"\n"
        + "    },\n"
        + "    \"2020-07-16\": {\n"
        + "      \"1. open\": \"122.6800\",\n"
        + "      \"2. high\": \"124.4800\",\n"
        + "      \"3. low\": \"122.1600\",\n"
        + "      \"4. close\": \"124.0100\",\n"
        + "      \"5. volume\": \"4330900\"\n"
        + "    },\n"
        + "    \"2020-07-15\": {\n"
        + "      \"1. open\": \"122.4000\",\n"
        + "      \"2. high\": \"123.9600\",\n"
        + "      \"3. low\": \"122.1500\",\n"
        + "      \"4. close\": \"123.0000\",\n"
        + "      \"5. volume\": \"4473400\"\n"
        + "    },\n"
        + "    \"2020-07-14\": {\n"
        + "      \"1. open\": \"118.6200\",\n"
        + "      \"2. high\": \"120.8900\",\n"
        + "      \"3. low\": \"117.9200\",\n"
        + "      \"4. close\": \"120.6000\",\n"
        + "      \"5. volume\": \"4534400\"\n"
        + "    },\n"
        + "    \"2020-07-13\": {\n"
        + "      \"1. open\": \"119.7800\",\n"
        + "      \"2. high\": \"120.9900\",\n"
        + "      \"3. low\": \"118.6600\",\n"
        + "      \"4. close\": \"119.2000\",\n"
        + "      \"5. volume\": \"4650700\"\n"
        + "    },\n"
        + "    \"2020-07-10\": {\n"
        + "      \"1. open\": \"115.5000\",\n"
        + "      \"2. high\": \"118.5700\",\n"
        + "      \"3. low\": \"115.2900\",\n"
        + "      \"4. close\": \"118.3500\",\n"
        + "      \"5. volume\": \"4285700\"\n"
        + "    },\n"
        + "    \"2020-07-09\": {\n"
        + "      \"1. open\": \"118.0000\",\n"
        + "      \"2. high\": \"118.0000\",\n"
        + "      \"3. low\": \"115.2000\",\n"
        + "      \"4. close\": \"115.7100\",\n"
        + "      \"5. volume\": \"4763000\"\n"
        + "    },\n"
        + "    \"2020-07-08\": {\n"
        + "      \"1. open\": \"118.0600\",\n"
        + "      \"2. high\": \"118.6400\",\n"
        + "      \"3. low\": \"116.4800\",\n"
        + "      \"4. close\": \"117.7100\",\n"
        + "      \"5. volume\": \"5192800\"\n"
        + "    },\n"
        + "    \"2020-07-07\": {\n"
        + "      \"1. open\": \"119.0000\",\n"
        + "      \"2. high\": \"119.5100\",\n"
        + "      \"3. low\": \"117.3300\",\n"
        + "      \"4. close\": \"117.5800\",\n"
        + "      \"5. volume\": \"4278100\"\n"
        + "    },\n"
        + "    \"2020-07-06\": {\n"
        + "      \"1. open\": \"121.2500\",\n"
        + "      \"2. high\": \"121.8500\",\n"
        + "      \"3. low\": \"119.4600\",\n"
        + "      \"4. close\": \"120.1900\",\n"
        + "      \"5. volume\": \"4045400\"\n"
        + "    },\n"
        + "    \"2020-07-02\": {\n"
        + "      \"1. open\": \"119.6900\",\n"
        + "      \"2. high\": \"121.4200\",\n"
        + "      \"3. low\": \"119.2600\",\n"
        + "      \"4. close\": \"119.7000\",\n"
        + "      \"5. volume\": \"3745800\"\n"
        + "    },\n"
        + "    \"2020-07-01\": {\n"
        + "      \"1. open\": \"120.2700\",\n"
        + "      \"2. high\": \"121.2300\",\n"
        + "      \"3. low\": \"118.3700\",\n"
        + "      \"4. close\": \"118.5400\",\n"
        + "      \"5. volume\": \"4655800\"\n"
        + "    },\n"
        + "    \"2020-06-30\": {\n"
        + "      \"1. open\": \"119.1900\",\n"
        + "      \"2. high\": \"121.2000\",\n"
        + "      \"3. low\": \"119.0000\",\n"
        + "      \"4. close\": \"120.7700\",\n"
        + "      \"5. volume\": \"3919500\"\n"
        + "    },\n"
        + "    \"2020-06-29\": {\n"
        + "      \"1. open\": \"117.9800\",\n"
        + "      \"2. high\": \"119.7800\",\n"
        + "      \"3. low\": \"117.3700\",\n"
        + "      \"4. close\": \"119.7500\",\n"
        + "      \"5. volume\": \"4159488\"\n"
        + "    },\n"
        + "    \"2020-06-26\": {\n"
        + "      \"1. open\": \"118.2600\",\n"
        + "      \"2. high\": \"118.9900\",\n"
        + "      \"3. low\": \"116.2600\",\n"
        + "      \"4. close\": \"117.1900\",\n"
        + "      \"5. volume\": \"10750100\"\n"
        + "    },\n"
        + "    \"2020-06-25\": {\n"
        + "      \"1. open\": \"116.7600\",\n"
        + "      \"2. high\": \"119.2100\",\n"
        + "      \"3. low\": \"116.1000\",\n"
        + "      \"4. close\": \"119.0300\",\n"
        + "      \"5. volume\": \"6130600\"\n"
        + "    },\n"
        + "    \"2020-06-24\": {\n"
        + "      \"1. open\": \"118.3200\",\n"
        + "      \"2. high\": \"118.3200\",\n"
        + "      \"3. low\": \"115.8800\",\n"
        + "      \"4. close\": \"116.4200\",\n"
        + "      \"5. volume\": \"6751000\"\n"
        + "    },\n"
        + "    \"2020-06-23\": {\n"
        + "      \"1. open\": \"122.0100\",\n"
        + "      \"2. high\": \"122.9000\",\n"
        + "      \"3. low\": \"119.2300\",\n"
        + "      \"4. close\": \"119.4100\",\n"
        + "      \"5. volume\": \"6632600\"\n"
        + "    },\n"
        + "    \"2020-06-22\": {\n"
        + "      \"1. open\": \"122.1200\",\n"
        + "      \"2. high\": \"122.5000\",\n"
        + "      \"3. low\": \"120.5300\",\n"
        + "      \"4. close\": \"121.0700\",\n"
        + "      \"5. volume\": \"4773500\"\n"
        + "    },\n"
        + "    \"2020-06-19\": {\n"
        + "      \"1. open\": \"126.1700\",\n"
        + "      \"2. high\": \"126.8200\",\n"
        + "      \"3. low\": \"122.2500\",\n"
        + "      \"4. close\": \"122.4700\",\n"
        + "      \"5. volume\": \"8099000\"\n"
        + "    },\n"
        + "    \"2020-06-18\": {\n"
        + "      \"1. open\": \"123.0000\",\n"
        + "      \"2. high\": \"124.4000\",\n"
        + "      \"3. low\": \"122.3300\",\n"
        + "      \"4. close\": \"124.1600\",\n"
        + "      \"5. volume\": \"2865400\"\n"
        + "    },\n"
        + "    \"2020-06-17\": {\n"
        + "      \"1. open\": \"125.8300\",\n"
        + "      \"2. high\": \"126.2500\",\n"
        + "      \"3. low\": \"123.4000\",\n"
        + "      \"4. close\": \"124.1500\",\n"
        + "      \"5. volume\": \"3154200\"\n"
        + "    },\n"
        + "    \"2020-06-16\": {\n"
        + "      \"1. open\": \"125.0000\",\n"
        + "      \"2. high\": \"127.5000\",\n"
        + "      \"3. low\": \"123.1600\",\n"
        + "      \"4. close\": \"125.1500\",\n"
        + "      \"5. volume\": \"5606700\"\n"
        + "    },\n"
        + "    \"2020-06-15\": {\n"
        + "      \"1. open\": \"119.1900\",\n"
        + "      \"2. high\": \"122.3700\",\n"
        + "      \"3. low\": \"118.2900\",\n"
        + "      \"4. close\": \"121.6500\",\n"
        + "      \"5. volume\": \"5149100\"\n"
        + "    },\n"
        + "    \"2020-06-12\": {\n"
        + "      \"1. open\": \"121.2500\",\n"
        + "      \"2. high\": \"123.1200\",\n"
        + "      \"3. low\": \"119.2800\",\n"
        + "      \"4. close\": \"121.9100\",\n"
        + "      \"5. volume\": \"6218100\"\n"
        + "    },\n"
        + "    \"2020-06-11\": {\n"
        + "      \"1. open\": \"126.0300\",\n"
        + "      \"2. high\": \"126.1000\",\n"
        + "      \"3. low\": \"117.8400\",\n"
        + "      \"4. close\": \"118.0100\",\n"
        + "      \"5. volume\": \"11763600\"\n"
        + "    },\n"
        + "    \"2020-06-10\": {\n"
        + "      \"1. open\": \"132.1500\",\n"
        + "      \"2. high\": \"132.2300\",\n"
        + "      \"3. low\": \"129.8000\",\n"
        + "      \"4. close\": \"129.8700\",\n"
        + "      \"5. volume\": \"4734800\"\n"
        + "    },\n"
        + "    \"2020-06-09\": {\n"
        + "      \"1. open\": \"133.5200\",\n"
        + "      \"2. high\": \"133.6000\",\n"
        + "      \"3. low\": \"131.0200\",\n"
        + "      \"4. close\": \"131.8700\",\n"
        + "      \"5. volume\": \"5393600\"\n"
        + "    },\n"
        + "    \"2020-06-08\": {\n"
        + "      \"1. open\": \"132.2700\",\n"
        + "      \"2. high\": \"135.8800\",\n"
        + "      \"3. low\": \"132.2700\",\n"
        + "      \"4. close\": \"135.7500\",\n"
        + "      \"5. volume\": \"5370500\"\n"
        + "    },\n"
        + "    \"2020-06-05\": {\n"
        + "      \"1. open\": \"133.8900\",\n"
        + "      \"2. high\": \"134.2300\",\n"
        + "      \"3. low\": \"131.7500\",\n"
        + "      \"4. close\": \"132.0600\",\n"
        + "      \"5. volume\": \"5892700\"\n"
        + "    },\n"
        + "    \"2020-06-04\": {\n"
        + "      \"1. open\": \"127.7800\",\n"
        + "      \"2. high\": \"128.9500\",\n"
        + "      \"3. low\": \"127.0200\",\n"
        + "      \"4. close\": \"128.8900\",\n"
        + "      \"5. volume\": \"3864800\"\n"
        + "    },\n"
        + "    \"2020-06-03\": {\n"
        + "      \"1. open\": \"127.1500\",\n"
        + "      \"2. high\": \"129.6000\",\n"
        + "      \"3. low\": \"127.0000\",\n"
        + "      \"4. close\": \"129.0500\",\n"
        + "      \"5. volume\": \"3917700\"\n"
        + "    },\n"
        + "    \"2020-06-02\": {\n"
        + "      \"1. open\": \"125.6700\",\n"
        + "      \"2. high\": \"126.0000\",\n"
        + "      \"3. low\": \"124.6600\",\n"
        + "      \"4. close\": \"126.0000\",\n"
        + "      \"5. volume\": \"2978100\"\n"
        + "    },\n"
        + "    \"2020-06-01\": {\n"
        + "      \"1. open\": \"124.6400\",\n"
        + "      \"2. high\": \"125.7500\",\n"
        + "      \"3. low\": \"124.0300\",\n"
        + "      \"4. close\": \"124.8900\",\n"
        + "      \"5. volume\": \"2871700\"\n"
        + "    },\n"
        + "    \"2020-05-29\": {\n"
        + "      \"1. open\": \"123.6700\",\n"
        + "      \"2. high\": \"125.1300\",\n"
        + "      \"3. low\": \"122.2400\",\n"
        + "      \"4. close\": \"124.9000\",\n"
        + "      \"5. volume\": \"7930500\"\n"
        + "    },\n"
        + "    \"2020-05-28\": {\n"
        + "      \"1. open\": \"126.8700\",\n"
        + "      \"2. high\": \"126.9700\",\n"
        + "      \"3. low\": \"124.2200\",\n"
        + "      \"4. close\": \"124.5300\",\n"
        + "      \"5. volume\": \"3915300\"\n"
        + "    },\n"
        + "    \"2020-05-27\": {\n"
        + "      \"1. open\": \"123.9400\",\n"
        + "      \"2. high\": \"125.8300\",\n"
        + "      \"3. low\": \"123.4700\",\n"
        + "      \"4. close\": \"125.5400\",\n"
        + "      \"5. volume\": \"5727500\"\n"
        + "    },\n"
        + "    \"2020-05-26\": {\n"
        + "      \"1. open\": \"121.3000\",\n"
        + "      \"2. high\": \"122.6200\",\n"
        + "      \"3. low\": \"121.0100\",\n"
        + "      \"4. close\": \"121.7600\",\n"
        + "      \"5. volume\": \"5469300\"\n"
        + "    },\n"
        + "    \"2020-05-22\": {\n"
        + "      \"1. open\": \"119.3700\",\n"
        + "      \"2. high\": \"119.4700\",\n"
        + "      \"3. low\": \"117.5900\",\n"
        + "      \"4. close\": \"118.3900\",\n"
        + "      \"5. volume\": \"4180800\"\n"
        + "    },\n"
        + "    \"2020-05-21\": {\n"
        + "      \"1. open\": \"120.9900\",\n"
        + "      \"2. high\": \"121.7200\",\n"
        + "      \"3. low\": \"118.9700\",\n"
        + "      \"4. close\": \"119.1200\",\n"
        + "      \"5. volume\": \"4000900\"\n"
        + "    },\n"
        + "    \"2020-05-20\": {\n"
        + "      \"1. open\": \"120.9300\",\n"
        + "      \"2. high\": \"122.4700\",\n"
        + "      \"3. low\": \"120.6000\",\n"
        + "      \"4. close\": \"121.3800\",\n"
        + "      \"5. volume\": \"3840700\"\n"
        + "    },\n"
        + "    \"2020-05-19\": {\n"
        + "      \"1. open\": \"121.1900\",\n"
        + "      \"2. high\": \"122.1700\",\n"
        + "      \"3. low\": \"120.1400\",\n"
        + "      \"4. close\": \"120.2900\",\n"
        + "      \"5. volume\": \"3241100\"\n"
        + "    },\n"
        + "    \"2020-05-18\": {\n"
        + "      \"1. open\": \"119.8800\",\n"
        + "      \"2. high\": \"122.3600\",\n"
        + "      \"3. low\": \"119.7500\",\n"
        + "      \"4. close\": \"121.5600\",\n"
        + "      \"5. volume\": \"4207600\"\n"
        + "    },\n"
        + "    \"2020-05-15\": {\n"
        + "      \"1. open\": \"115.9300\",\n"
        + "      \"2. high\": \"117.3900\",\n"
        + "      \"3. low\": \"115.2500\",\n"
        + "      \"4. close\": \"116.9800\",\n"
        + "      \"5. volume\": \"4786300\"\n"
        + "    },\n"
        + "    \"2020-05-14\": {\n"
        + "      \"1. open\": \"114.5700\",\n"
        + "      \"2. high\": \"117.0900\",\n"
        + "      \"3. low\": \"111.8100\",\n"
        + "      \"4. close\": \"116.9500\",\n"
        + "      \"5. volume\": \"5259400\"\n"
        + "    },\n"
        + "    \"2020-05-13\": {\n"
        + "      \"1. open\": \"119.9500\",\n"
        + "      \"2. high\": \"119.9900\",\n"
        + "      \"3. low\": \"114.8500\",\n"
        + "      \"4. close\": \"115.7300\",\n"
        + "      \"5. volume\": \"5882800\"\n"
        + "    },\n"
        + "    \"2020-05-12\": {\n"
        + "      \"1. open\": \"123.0100\",\n"
        + "      \"2. high\": \"124.3200\",\n"
        + "      \"3. low\": \"120.2600\",\n"
        + "      \"4. close\": \"120.2600\",\n"
        + "      \"5. volume\": \"4784500\"\n"
        + "    },\n"
        + "    \"2020-05-11\": {\n"
        + "      \"1. open\": \"121.8100\",\n"
        + "      \"2. high\": \"123.4500\",\n"
        + "      \"3. low\": \"120.6700\",\n"
        + "      \"4. close\": \"122.5900\",\n"
        + "      \"5. volume\": \"3535300\"\n"
        + "    },\n"
        + "    \"2020-05-08\": {\n"
        + "      \"1. open\": \"122.6700\",\n"
        + "      \"2. high\": \"123.2300\",\n"
        + "      \"3. low\": \"121.0600\",\n"
        + "      \"4. close\": \"122.9900\",\n"
        + "      \"5. volume\": \"5003900\"\n"
        + "    },\n"
        + "    \"2020-05-07\": {\n"
        + "      \"1. open\": \"122.9800\",\n"
        + "      \"2. high\": \"123.2600\",\n"
        + "      \"3. low\": \"120.8500\",\n"
        + "      \"4. close\": \"121.2300\",\n"
        + "      \"5. volume\": \"4412600\"\n"
        + "    },\n"
        + "    \"2020-05-06\": {\n"
        + "      \"1. open\": \"123.2400\",\n"
        + "      \"2. high\": \"124.0500\",\n"
        + "      \"3. low\": \"122.4100\",\n"
        + "      \"4. close\": \"123.1700\",\n"
        + "      \"5. volume\": \"3864600\"\n"
        + "    },\n"
        + "    \"2020-05-05\": {\n"
        + "      \"1. open\": \"123.3900\",\n"
        + "      \"2. high\": \"124.3200\",\n"
        + "      \"3. low\": \"122.4700\",\n"
        + "      \"4. close\": \"122.5800\",\n"
        + "      \"5. volume\": \"3899400\"\n"
        + "    },\n"
        + "    \"2020-05-04\": {\n"
        + "      \"1. open\": \"120.8200\",\n"
        + "      \"2. high\": \"121.9700\",\n"
        + "      \"3. low\": \"119.3900\",\n"
        + "      \"4. close\": \"121.6800\",\n"
        + "      \"5. volume\": \"4017900\"\n"
        + "    },\n"
        + "    \"2020-05-01\": {\n"
        + "      \"1. open\": \"123.1900\",\n"
        + "      \"2. high\": \"123.4700\",\n"
        + "      \"3. low\": \"121.3900\",\n"
        + "      \"4. close\": \"121.8700\",\n"
        + "      \"5. volume\": \"4925500\"\n"
        + "    },\n"
        + "    \"2020-04-30\": {\n"
        + "      \"1. open\": \"126.5200\",\n"
        + "      \"2. high\": \"127.2700\",\n"
        + "      \"3. low\": \"125.2200\",\n"
        + "      \"4. close\": \"125.5600\",\n"
        + "      \"5. volume\": \"6635800\"\n"
        + "    },\n"
        + "    \"2020-04-29\": {\n"
        + "      \"1. open\": \"128.8800\",\n"
        + "      \"2. high\": \"129.3100\",\n"
        + "      \"3. low\": \"127.5300\",\n"
        + "      \"4. close\": \"128.6900\",\n"
        + "      \"5. volume\": \"5257600\"\n"
        + "    },\n"
        + "    \"2020-04-28\": {\n"
        + "      \"1. open\": \"128.0300\",\n"
        + "      \"2. high\": \"128.2000\",\n"
        + "      \"3. low\": \"125.3800\",\n"
        + "      \"4. close\": \"126.2700\",\n"
        + "      \"5. volume\": \"4778100\"\n"
        + "    },\n"
        + "    \"2020-04-27\": {\n"
        + "      \"1. open\": \"125.5600\",\n"
        + "      \"2. high\": \"126.9900\",\n"
        + "      \"3. low\": \"125.4700\",\n"
        + "      \"4. close\": \"125.9200\",\n"
        + "      \"5. volume\": \"4923800\"\n"
        + "    },\n"
        + "    \"2020-04-24\": {\n"
        + "      \"1. open\": \"122.4100\",\n"
        + "      \"2. high\": \"125.0000\",\n"
        + "      \"3. low\": \"120.7600\",\n"
        + "      \"4. close\": \"124.7200\",\n"
        + "      \"5. volume\": \"4987300\"\n"
        + "    }\n"
        + "  }\n"
        + "}";

    given(this.mockRestTemplate.getForEntity(avURL, String.class))
        .willReturn(new ResponseEntity(body, HttpStatus.OK));

    // perform test on mock template
    this.mvc.perform(
        get("/prices")
            .param("stock", "IBM")
            .param("days", "1")
            .accept(MediaType.APPLICATION_JSON_VALUE))
            .andExpect(MockMvcResultMatchers.content().json(result)); // use this instead of jsonPath to be more lenient with formatting differences
            //.andExpect(jsonPath("$", is(formattedResult)));

  }
}

